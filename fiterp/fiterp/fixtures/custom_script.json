[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Leave Application", 
  "modified": "2018-01-19 18:18:44.572631", 
  "name": "Leave Application-Client", 
  "script": "// 5 Jan 2018\n// Note: we need to modify a few lines in leave_application.js also\n\nfrappe.ui.form.on(\"Leave Application\", {\n    \"employee\": function(frm) {\n\n    //reset & clear fields when employee get updated\t\n    frm.set_value(\"approver_sup\",\"\");\n    refresh_field(\"approver_sup\");\n\t\n    frm.set_value(\"approver_senior_mgr\",\"\");\n    refresh_field(\"approver_senior_mgr\");\n    \n    frm.set_value(\"approver_dean\",\"\");\n    refresh_field(\"approver_dean\");  \n  \n\n    //This is the one that will be used\n    if (frm.doc.employee && frm.doc.employee_department) { \n    frappe.call({\n        method: \"erpnext.controllers.queries.get_approver_fit\",\n        args: {\n            _employee: frm.doc.employee,\n            _department: \"\u0e2a\u0e33\u0e19\u0e31\u0e01\u0e07\u0e32\u0e19\u0e04\u0e13\u0e1a\u0e14\u0e35\",\n            _mgtlevel: 3\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n              frm.set_df_property(\"approver_dean\", \"options\", r.message);\n\t\t      frm.set_value(\"approver_dean\", r.message[0]);\n            }\n            else  {\n\t\t      var defoptions = [\"-n/a-\"];\n\t\t      frm.set_df_property(\"approver_dean\", \"options\", defoptions);\n\t\t      frm.set_value(\"approver_dean\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\n\n    //second call\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_approver_fit\",\n        args: {\n            _employee: frm.doc.employee,\n            _department: frm.doc.employee_department,\n            _mgtlevel: 2\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n              frm.set_df_property(\"approver_senior_mgr\", \"options\", r.message);\n\t\t      frm.set_value(\"approver_senior_mgr\", r.message[0]);\n            }\n            else  {\n\t\t      var defoptions = [\"-n/a-\"];\n\t\t      frm.set_df_property(\"approver_senior_mgr\", \"options\", defoptions);\n\t\t      frm.set_value(\"approver_senior_mgr\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\n  \n    frappe.call({\n        method: \"erpnext.controllers.queries.get_approver_fit\",\n        args: {\n            _employee: frm.doc.employee,\n            _department: frm.doc.employee_department,\n            _mgtlevel: 1\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n                frm.set_df_property(\"approver_sup\", \"options\", r.message);\n                frm.set_value(\"approver_sup\", r.message[0]);\n            }\n            else  {\n                var defoptions = [\"-n/a-\"];\n                frm.set_df_property(\"approver_sup\", \"options\", defoptions);\n                frm.set_value(\"approver_sup\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\n\n//to be covered by\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_covering_employee\",\n        args: {\n            _employee: frm.doc.employee,\n            _department: frm.doc.employee_department,\n            _mgtlevel: 1\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t          r.message.unshift(\" \");\n                  frm.set_df_property(\"to_be_covered_by\", \"options\", r.message);\n            }\n            else  {\n\t\t      var defoptions = [\" \"];\n\t\t      frm.set_df_property(\"to_be_covered_by\", \"options\", defoptions);\n\t\t      frm.set_value(\"to_be_covered_by\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\n\t}\n\n//get latest leave\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_latest_leave\",\n        args: {\n            _employee: frm.doc.employee,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message && !isNaN((r.message[0]).getDate()) ) {\n\t\t  frm.set_value(\"starting_date\", r.message[0]);\n            }\n            else  {\n\t\t      var defoptions = [\"  \"];\n\t\t      frm.set_value(\"starting_date\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\n//get latest leave\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_latest_leave2\",\n        args: {\n            _employee: frm.doc.employee,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t//if (r.message != \"null\") {\n\t\t frm.set_value(\"starting_date\", r.message[0][0]);\n\t\t frm.set_value(\"end_date\", r.message[0][1]);\n\t\t frm.set_value(\"posted_date\", r.message[0][2]);\n\t\t frm.set_value(\"total_leave_days2\", r.message[0][3]);\n\n\t\tvar template = \"<table><tbody>{% for (var row in rows) { %}<tr>{% for (var col in rows[row]) { %}<td>{{rows[row][col] }}</td>{% } %}</tr>{% } %}</tbody></table>\"; \n\t\t//frm.set_df_property('html_field', 'options',frappe.render(template, {rows: r.message})); \n\t\t//frm.refresh_field('html_field');\n\t\t//}\n            }\n            else  {\n\t\t     // alert(\"test1\");\n\t\t      var defoptions = [\"  \"];\n\t\t      //frm.set_value(\"starting_date\", defoptions[0]);\n\t\t      //frm.set_value(\"end_date\", defoptions[0]);\n            }\n        }\n   \t});  // frappe.call end here.\n\nfrm.set_value(\"approver_1_email\", \"-n/a-\");\nfrm.set_value(\"approver_2_email\", \"-n/a-\");\nfrm.set_value(\"approver_3_email\", \"-n/a-\");\n\n\n}, // end of \"employee\" changed event\n\n/////////////////\n\"approver_sup\": function(frm) {\n//    var defoptions = [\"-n/a-\"];\n//\tif (frm.doc.approver_sup != \"-n/a-\")  \n//\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_sup);\t\n//\telse {\n//\t\tif (frm.doc.approver_senior_mgr != \"-n/a-\") \n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_senior_mgr);\n//\t\telse\n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_dean);\t\n//\t}\n\n\nif (frm.doc.approver_sup != \"-n/a-\") {\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_leave_approver\",\n        args: {\n            _employee_name: frm.doc.approver_sup,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t      frm.set_value(\"approver_1_email\", r.message);\n            }\n        }\n   \t});  // frappe.call end here.\n}\n\n},\n\n\n\"approver_senior_mgr\": function(frm) {\n//    var defoptions = [\"-n/a-\"];\n//\tif (frm.doc.approver_sup != \"-n/a-\")  \n//\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_sup);\t\n//\telse {\n//\t\tif (frm.doc.approver_senior_mgr != \"-n/a-\") \n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_senior_mgr);\n//\t\telse\n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_dean);\t\n//\t}\n\n\nif (frm.doc.approver_senior_mgr != \"-n/a-\") {\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_leave_approver\",\n        args: {\n            _employee_name: frm.doc.approver_senior_mgr,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t      frm.set_value(\"approver_2_email\", r.message);\n            }\n        }\n   \t});  // frappe.call end here.\n}\n\n},\n\n\n\"approver_dean\": function(frm) {\n//    var defoptions = [\"-n/a-\"];\n//\tif (frm.doc.approver_sup != \"-n/a-\")  \n//\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_sup);\t\n//\telse {\n//\t\tif (frm.doc.approver_senior_mgr != \"-n/a-\") \n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_senior_mgr);\n//\t\telse\n//\t\t\tfrm.set_value(\"next_leave_approver\", frm.doc.approver_dean);\t\n//\t}\n\n\nif (frm.doc.approver_dean != \"-n/a-\") {\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_leave_approver\",\n        args: {\n            _employee_name: frm.doc.approver_dean,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t      frm.set_value(\"approver_3_email\", r.message);\n            }\n        }\n   \t});  // frappe.call end here.\n}\n\n},\n\n\n\"to_be_covered_by\": function(frm) {\n    frappe.call({\n        method: \"erpnext.controllers.queries.get_leave_approver\",\n        args: {\n            _employee_name: frm.doc.to_be_covered_by,\n   \t    },\n   \t    callback: function(r) {\n            if (!r.exc && r.message) {\n\t\t      frm.set_value(\"covered_person_email\", r.message);\n            }\n        }\n   \t});  // frappe.call end here.\n},\n////////////////\n\nonload: function(frm) {\n\t//alert(\"test onload\");\n\t//refresh_field(\"approver_sup\");\n\t\t//code modified so that user does not need to select employee id\n},\n\n\n\"status\": function(frm) {\n\t//alert(\"status change\");\n\t//frm.save();\n},\n\n\"workflow_state\": function(frm) {\n\t//alert(\"workflow status change\");\n\t//frm.save();\n\n},\n\n//\"leave_approver_name\": function(frm) {\n//    //This is the one that will be used\n//    frappe.call({\n//        method: \"erpnext.controllers.queries.get_leave_approver\",\n//        args: {\n//            _employee_name: frm.doc.leave_approver_name,\n//   \t    },\n//   \t    callback: function(r) {\n//            if (!r.exc && r.message) {\n//\t\tfrm.set_value(\"approver_email\", r.message);\n//            }\n//            else  {\n//\t\tfrm.set_value(\"approver_email\", \"nopporn@it.kmitl.ac.th\");\n//            }\n//  \n//        }\n//   \t});  // frappe.call end here.\n\n//},\n\n\n\n});\n\ncur_frm.cscript.custom_refresh = function(doc) {\n    cur_frm.set_df_property(\"department\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"approver_sup\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"approver_senior_mgr\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"approver_dean\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"to_be_covered_by\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"description\", \"read_only\", doc.__islocal ? 0 : 1);\n    \n\n    if (doc.workflow_state != \"Draft\") {\n    cur_frm.set_df_property(\"half_day_pm\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"half_day_am\", \"read_only\", doc.__islocal ? 0 : 1);\n    cur_frm.set_df_property(\"attached_documents\", \"read_only\", doc.__islocal ? 0 : 1);    \n    }\n}\n\n\n\n\n\n\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Employee", 
  "modified": "2018-01-02 14:18:06.078003", 
  "name": "Employee-Client", 
  "script": "//frappe.ui.form.on(\"Employee\", \"validate\", function(frm) {\n        //var nos = frm.doc.credit_days* 1;\n        //var ddate = frappe.datetime.add_days(frm.doc.date_of_joining,-1);\n        //cur_frm.set_value(\"date_of_birth\", ddate);\n//frappe.ui.form.on(\"Employee\", \"validate\", function(frm) {\n//    trigger: function(frm) {\n//        var month = new Array();\n//        month[0] = \"\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21\";\n//        month[1] = \"\u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c\";\n//        month[2] = \"\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21\";\n//        month[3] = \"\u0e40\u0e21\u0e29\u0e32\u0e22\u0e19\";\n//        month[4] = \"\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21\";\n//        month[5] = \"\u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19\";\n//        month[6] = \"\u0e01\u0e23\u0e01\u0e0f\u0e32\u0e04\u0e21\";\n//        month[7] = \"\u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21\";\n//        month[8] = \"\u0e01\u0e31\u0e19\u0e22\u0e19\u0e22\u0e19\";\n//        month[9] = \"\u0e15\u0e38\u0e25\u0e32\u0e04\u0e21\";\n//        month[10] = \"\u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19\";\n//        month[11] = \"\u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21\";\n//        var today = new Date(frm.doc.date_of_joining);\n//        var n = today.getFullYear() + 543;\n//        var m = month[today.getMonth()];\n//\tvar d  = today.getDate();\n//        frm.set_value(\"buddhist_year\", d + \" \" + m + \" \" + n);\n//});\n\n\nfrappe.ui.form.on(\"Employee\", {\n  \"date_of_joining\": function(frm) { \n    frm.cscript.custom_refresh();\n  }\n});\n\ncur_frm.cscript.custom_refresh = function(doc) {\n   // cbm = doc.length * doc.width * doc.height;\n        var month = new Array();\n        month[0] = \"\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21\";\n        month[1] = \"\u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c\";\n        month[2] = \"\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21\";\n        month[3] = \"\u0e40\u0e21\u0e29\u0e32\u0e22\u0e19\";\n        month[4] = \"\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21\";\n        month[5] = \"\u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19\";\n        month[6] = \"\u0e01\u0e23\u0e01\u0e0f\u0e32\u0e04\u0e21\";\n        month[7] = \"\u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21\";\n        month[8] = \"\u0e01\u0e31\u0e19\u0e22\u0e32\u0e22\u0e19\";\n        month[9] = \"\u0e15\u0e38\u0e25\u0e32\u0e04\u0e21\";\n        month[10] = \"\u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19\";\n        month[11] = \"\u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21\";\n\tif (cur_frm.doc.date_of_joining != undefined) { \n        \tvar today = new Date(cur_frm.doc.date_of_joining);\n        \tvar y = today.getFullYear() + 543;\n        \tvar m = month[today.getMonth()];\n\t\tvar d  = today.getDate();\n        \tcur_frm.set_value(\"buddhist_year\", d + \" \" + m + \" \" + y);\n\t}\n\n    \t//cur_frm.set_value(\"buddhist_year\", 2009);\n}\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "User", 
  "modified": "2018-01-02 14:18:06.095327", 
  "name": "User-Client", 
  "script": "frappe.ui.form.on(\"User\", \"validate\", function(frm) {\n    \tif (frm.doc.name != \"dummyx@it.kmitl.ac.th\" && frappe.session.user != 'Administrator') {\n    \t\tmsgprint(\"You can not change the language!\");\n    \t\tvalidated = false;\n    \t}\n\t//else alert(\"OK\");\n});", 
  "script_type": "Client"
 }
]